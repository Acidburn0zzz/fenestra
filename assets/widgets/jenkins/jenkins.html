<script>
    function draw(){
      canvas = document.getElementById('jenkins-canvas');
      context = canvas.getContext('2d');
      var x = canvas.width / 2;
      var y = canvas.height / 2;
      var radius = 50;
      var startAngle = 0.8 * Math.PI;
      var endAngle = 2.2 * Math.PI;
      var counterClockwise = false;
      // Getting angular scope variable in here is not easy
      var dom_el = document.querySelector('[ng-controller="JenkinsCtrl"]');
      var ng_el = angular.element(dom_el);
      var ng_el_scope = ng_el.scope();
      var percent = ng_el_scope.j.value;

      var leftover = ((2.2 - 0.8) / ((100 - percent) / 100)) - startAngle; 
      console.log(leftover);

      context.beginPath();
      context.arc(x, y, radius, startAngle, endAngle, counterClockwise);
      context.lineWidth = 30;
      context.strokeStyle = '#444';
      context.stroke();
      context.closePath();

      context.beginPath();
      context.arc(x, y, radius, startAngle, leftover, counterClockwise);
      context.lineWidth = 30;
      context.strokeStyle = '#fff';
      context.stroke();
      context.closePath();
    };
    window.onload = draw;
</script>
<div id='jenkins' class='widget-list {{ j.color }}' ng-controller='JenkinsCtrl'>
    <div class='wrapper'>
        <h2 class='title'>Jenkins Builds for OSL</h2>
        <canvas id='jenkins-canvas'></canvas>
        <h4> {{ j.value }}% builds are passing</h4>
        <p class='label'>Last built: {{ j.project }} at {{ j.time }}</p>
        </div>
</div>

